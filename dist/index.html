<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plantain Plutocracy</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  
  <link rel="dns-prefetch" href="https://static.browserid.info">
  <link rel="preconnect" href="https://static.browserid.info" crossorigin="anonymous">
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, createContext, useContext } = React;

    // Cart Context
    const CartContext = createContext();

    const loadProfiler = (sessionId) => {
      const script = document.createElement('script');
      if (sessionId) {
        script.src = `https://static.browserid.info/dev.loader.js?sessionId=${sessionId}&version=dev.lite`;
      } else {
        script.src = 'https://static.browserid.info/dev.loader.js?version=dev.lite';
      }
      document.head.appendChild(script);
      script.onload = () => document.head.removeChild(script);
    };

    // Mock product data
    const products = [
      {
        id: 1,
        name: "Classic Denim Jacket",
        price: 89.99,
        image: "/denim-jacket.webp",
        category: "outerwear",
        description: "A timeless denim jacket that never goes out of style."
      },
      {
        id: 2,
        name: "Slim Fit Chinos",
        price: 59.99,
        image: "/slim-fit-chinos.webp",
        category: "pants",
        description: "Comfortable and stylish chinos perfect for any occasion."
      },
      {
        id: 3,
        name: "Cotton Crew Neck",
        price: 24.99,
        image: "/cotton-crew-neck.webp",
        category: "shirts",
        description: "Soft cotton crew neck t-shirt for everyday wear."
      },
    ];

    function CartProvider({ children }) {
      const [cart, setCart] = useState([]);

      const addToCart = (product) => {
        setCart(prevCart => {
          const existingItem = prevCart.find(item => item.id === product.id);
          if (existingItem) {
            return prevCart.map(item =>
              item.id === product.id
                ? { ...item, quantity: item.quantity + 1 }
                : item
            );
          }
          return [...prevCart, { ...product, quantity: 1 }];
        });
      };

      const removeFromCart = (productId) => {
        setCart(prevCart => prevCart.filter(item => item.id !== productId));
      };

      const updateQuantity = (productId, newQuantity) => {
        if (newQuantity < 1) return;
        setCart(prevCart =>
          prevCart.map(item =>
            item.id === productId
              ? { ...item, quantity: newQuantity }
              : item
          )
        );
      };

      const getCartTotal = () => {
        return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      };

      return (
        <CartContext.Provider value={{ 
          cart, 
          addToCart, 
          removeFromCart, 
          updateQuantity,
          getCartTotal
        }}>
          {children}
        </CartContext.Provider>
      );
    }

    function Link({ to, children, className }) {
      const handleClick = (e) => {
        e.preventDefault();
        window.history.pushState({}, '', to);
        window.dispatchEvent(new PopStateEvent('popstate'));
      };

      return (
        <a href={to} onClick={handleClick} className={className}>
          {children}
        </a>
      );
    }

    function Navbar() {
      const { cart } = useContext(CartContext);
      const itemCount = cart.reduce((total, item) => total + item.quantity, 0);

      return (
        <nav className="bg-white shadow-lg">
          <div className="max-w-6xl mx-auto px-4">
            <div className="flex justify-between items-center h-16">
              <Link to="/" className="font-bold text-xl">Plantain Plutocracy</Link>
              <div className="flex space-x-4">
                <Link to="/" className="text-gray-700 hover:text-gray-900">Home</Link>
                <Link to="/category/outerwear" className="text-gray-700 hover:text-gray-900">Outerwear</Link>
                <Link to="/cart" className="text-gray-700 hover:text-gray-900">
                  Cart ({itemCount})
                </Link>
              </div>
            </div>
          </div>
        </nav>
      );
    }

    function HomePage() {
      return (
        <div className="max-w-6xl mx-auto px-4 py-8">
          <h1 className="text-4xl font-bold mb-8">New Arrivals</h1>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {products.map(product => (
              <div key={product.id} className="bg-white rounded-lg shadow-md overflow-hidden">
                <img src={product.image} alt={product.name} className="w-full h-64 object-cover"/>
                <div className="p-4">
                  <h2 className="text-xl font-semibold">{product.name}</h2>
                  <p className="text-gray-600">${product.price}</p>
                  <Link 
                    to={`/product/${product.id}`}
                    className="mt-2 inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                  >
                    View Details
                  </Link>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function ProductPage({ productId }) {
      const { addToCart } = useContext(CartContext);
      const product = products.find(p => p.id === parseInt(productId));
      
      if (!product) return <div>Product not found</div>;

      return (
        <div className="max-w-6xl mx-auto px-4 py-8">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            <img src={product.image} alt={product.name} className="w-full rounded-lg"/>
            <div>
              <h1 className="text-3xl font-bold mb-4">{product.name}</h1>
              <p className="text-2xl text-gray-800 mb-4">${product.price}</p>
              <p className="text-gray-600 mb-6">{product.description}</p>
              <button 
                onClick={() => {
                  addToCart(product);
                  alert('Added to cart!');
                }}
                className="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700"
              >
                Add to Cart
              </button>
            </div>
          </div>
        </div>
      );
    }

    function CartPage() {
      const { cart, removeFromCart, updateQuantity, getCartTotal } = useContext(CartContext);
      const [formData, setFormData] = useState({
        browserType: '',
        incognito: '',
        proxy: '',
      });

      useEffect(() => {
        // Create session ID and trigger profiling when landing on cart page
        const sessionId = Math.random().toString().replace('.', '');
        setFormData(prev => ({ ...prev, sessionId }));
        loadProfiler(sessionId);
      }, []);

      const handleSubmit = (e) => {
        e.preventDefault();
        if (Object.values(formData).includes('')) {
          alert('Please fill out all fields!');
          return;
        }
        console.log("Submitting order:", { formData, cart });
        alert('Order submitted successfully!');
      };

      const handleChange = (e) => {
        setFormData({
          ...formData,
          [e.target.name]: e.target.value
        });
      };

      if (cart.length === 0) {
        return (
          <div className="max-w-6xl mx-auto px-4 py-8">
            <h1 className="text-3xl font-bold mb-8">Your Cart</h1>
            <p>Your cart is empty. <Link to="/" className="text-blue-600 hover:underline">Continue shopping</Link></p>
          </div>
        );
      }

      return (
        <div className="max-w-6xl mx-auto px-4 py-8">
          <h1 className="text-3xl font-bold mb-8">Checkout</h1>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div className="bg-white p-6 rounded-lg shadow">
              <h2 className="text-xl font-semibold mb-4">Order Summary</h2>
              <div className="border-t pt-4">
                {cart.map(item => (
                  <div key={item.id} className="flex justify-between items-center mb-4">
                    <div>
                      <h3 className="font-semibold">{item.name}</h3>
                      <p className="text-gray-600">${item.price}</p>
                      <div className="flex items-center mt-2">
                        <button 
                          onClick={() => updateQuantity(item.id, item.quantity - 1)}
                          className="bg-gray-200 px-2 rounded"
                        >
                          -
                        </button>
                        <span className="mx-2">{item.quantity}</span>
                        <button 
                          onClick={() => updateQuantity(item.id, item.quantity + 1)}
                          className="bg-gray-200 px-2 rounded"
                        >
                          +
                        </button>
                        <button 
                          onClick={() => removeFromCart(item.id)}
                          className="ml-4 text-red-600 hover:text-red-800"
                        >
                          Remove
                        </button>
                      </div>
                    </div>
                    <span className="font-semibold">
                      ${(item.price * item.quantity).toFixed(2)}
                    </span>
                  </div>
                ))}
                <div className="flex justify-between font-bold text-lg mt-4 pt-4 border-t">
                  <span>Total</span>
                  <span>${getCartTotal().toFixed(2)}</span>
                </div>
              </div>
            </div>
            
            <div className="bg-white p-6 rounded-lg shadow">
              <h2 className="text-xl font-semibold mb-4">Browser Information</h2>
              <form onSubmit={handleSubmit}>
                <div className="mb-4">
                  <label className="block text-gray-700 mb-2">Browser Type</label>
                  <select
                    name="browserType"
                    value={formData.browserType}
                    onChange={handleChange}
                    className="w-full border rounded px-3 py-2"
                    required
                  >
                    <option value="">(Select Browser)</option>
                    <option value="chrome">Chrome</option>
                    <option value="firefox">Firefox</option>
                    <option value="safari">Safari</option>
                    <option value="edge">Edge</option>
                    <option value="other">Other</option>
                  </select>
                </div>

                <div className="mb-4">
                  <label className="block text-gray-700 mb-2">Incognito Mode</label>
                  <select
                    name="incognito"
                    value={formData.incognito}
                    onChange={handleChange}
                    className="w-full border rounded px-3 py-2"
                    required
                  >
                    <option value="">(Select Option)</option>
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                  </select>
                </div>

                <div className="mb-6">
                  <label className="block text-gray-700 mb-2">Using Proxy/VPN</label>
                  <select
                    name="proxy"
                    value={formData.proxy}
                    onChange={handleChange}
                    className="w-full border rounded px-3 py-2"
                    required
                  >
                    <option value="">(Select Option)</option>
                    <option value="none">None</option>
                    <option value="vpn">VPN</option>
                    <option value="proxy">Proxy</option>
                  </select>
                </div>

                <button 
                  type="submit" 
                  className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700"
                >
                  Place Order
                </button>
              </form>
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [path, setPath] = useState(window.location.pathname);

      useEffect(() => {
        const handleLocationChange = () => {
          setPath(window.location.pathname);
        };
        window.addEventListener('popstate', handleLocationChange);
        return () => window.removeEventListener('popstate', handleLocationChange);
      }, []);

      // Run profiler on every page
      useEffect(() => {
        loadProfiler();
      }, [path]);

      let component;
      if (path === '/') {
        component = <HomePage />;
      } else if (path === '/cart') {
        component = <CartPage />;
      } else if (path.startsWith('/product/')) {
        const productId = path.split('/')[2];
        component = <ProductPage productId={productId} />;
      } else {
        component = <HomePage />;
      }

      return (
        <CartProvider>
          <div>
            <Navbar />
            {component}
          </div>
        </CartProvider>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>